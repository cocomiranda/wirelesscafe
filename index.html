<!DOCTYPE html>
<html id="html">
  <head>
    <title>Work 'n Coffee</title>
    <link rel="icon" type="image/x-icon" href="logo.png">
    <link rel="stylesheet" href="style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

  </head>
  <body>
    
    <h1 style="margin-top: 10px;"><img src="logo.png" style="margin-left: 10px; height: 35px; width: 35px;">&nbspWork 'n Coffee</h1>
    <h3>Encontrá el café con el mejor WiFi</h3>
    <h5 style="color: red;">*v1 solo para CABA</h5>
    <form id="form">
        <label for="coffee-name" style="display: none;">Cafeteria:<span style="font-size: 11px; font-style: italic; display: none;">(*obligatorio)</span></label>
        <input type="text" id="coffee-name" name="coffee-name" required style="display: none;">
        
        <label for="street" style="display: none;">Direccion:</label>
        <input type="text" id="street" name="street" style="display: none;">
        <br>
        
        <label for="street">Cafeteria:&nbsp<span style="font-size: 11px; font-style: italic;">(*obligatorio)</span></label><input id="pac-input" type="text" placeholder="Ingresar nombre y dirección" />
        
        <body>
          <div>
            <div class="pac-card" id="pac-card">
            </div>
            <div id="map" style="height: 200px;"></div>
            <div id="infowindow-content">
              <span id="place-name" class="title"></span><br />
              <span id="place-address"></span>
            </div>
          </div>
          <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtt1qJ3l8AhfdaDszw-P4RCWztmZI2YDE&callback=initMap&libraries=places&v=weekly"
            defer
          ></script>
        </body>

        <br>
        <label for="barrio">Barrio:&nbsp<span style="font-size: 11px; font-style: italic;">(*obligatorio)</span></label>
        <select id="barrio" name="barrio">
            <option value="" disabled selected>-</option>
            <option value="Agronomía">Agronomía</option>
            <option value="Almagro">Almagro</option>
            <option value="Balvanera">Balvanera</option>
            <option value="Barracas">Barracas</option>
            <option value="Belgrano">Belgrano</option>
            <option value="Boedo">Boedo</option>
            <option value="Caballito">Caballito</option>
            <option value="Chacarita">Chacarita</option>
            <option value="Coghlan">Coghlan</option>
            <option value="Colegiales">Colegiales</option>
            <option value="Constitución">Constitución</option>
            <option value="Flores">Flores</option>
            <option value="Floresta">Floresta</option>
            <option value="La Boca">La Boca</option>
            <option value="La Paternal">La Paternal</option>
            <option value="Liniers">Liniers</option>
            <option value="Mataderos">Mataderos</option>
            <option value="Monte Castro">Monte Castro</option>
            <option value="Monserrat">Monserrat</option>
            <option value="Nueva Pompeya">Nueva Pompeya</option>
            <option value="Núñez">Núñez</option>
            <option value="Palermo">Palermo</option>
            <option value="Parque Avellaneda">Parque Avellaneda</option>
            <option value="Parque Chacabuco">Parque Chacabuco</option>
            <option value="Parque Chas">Parque Chas</option>
            <option value="Parque Patricios">Parque Patricios</option>
            <option value="Puerto Madero">Puerto Madero</option>
            <option value="Recoleta">Recoleta</option>
            <option value="Retiro">Retiro</option>
            <option value="Saavedra">Saavedra</option>
            <option value="San Cristóbal">San Cristóbal</option>
            <option value="San Nicolás">San Nicolás</option>
            <option value="San Telmo">San Telmo</option>
            <option value="Vélez Sársfield">Vélez Sársfield</option>
            <option value="Versalles">Versalles</option>
            <option value="Villa Crespo">Villa Crespo</option>
            <option value="Villa del Parque">Villa del Parque</option>
            <option value="Villa Devoto">Villa Devoto</option>
            <option value="Villa Gral. Mitre">Villa Gral. Mitre</option>
            <option value="Villa Lugano">Villa Lugano</option>
            <option value="Villa Luro">Villa Luro</option>
            <option value="Villa Ortúzar">Villa Ortúzar</option>
            <option value="Villa Pueyrredón">Villa Pueyrredón</option>
            <option value="Villa Real">Villa Real</option>
            <option value="Villa Riachuelo">Villa Riachuelo</option>
            <option value="Villa Santa Rita">Villa Santa Rita</option>
            <option value="Villa Soldati">Villa Soldati</option>
            <option value="Villa Urquiza">Villa Urquiza</option>
        </select>
        
        <br>

        <br>
        <label for="wifi-rating">Rating WiFi:&nbsp<span style="font-size: 11px; font-style: italic;">(*obligatorio)</span></label>
        <select id="wifi-rating" name="wifi-rating" required>
            <option value="" disabled selected>-</option>
            <option value="1">1 - Muy Malo</option>
            <option value="2">2 - Malo</option>
            <option value="3">3 - Normal</option>
            <option value="4">4 - Bueno</option>
            <option value="5">5 - Excelente</option>
        </select>
        
        <br>

        <div style="display: none;">
          <label for="speed-down">Velocidad bajada (Mbps)</label>
          <input type="number" min="0" id="speed-down" name="speed-down">
          <br>
          <label for="speed-up">Velocidad subida (Mbps)</label>
          <input type="number" min="0" id="speed-up" name="speed-up">
        </div>
        <br>

        
        <button type="button" id="insert" style="margin-left: 40%;">Enter</button>
        <!-- onsubmit="return validateForm()" -->
    </form>
    <br><br>

    


    <div id="formContents"></div>
    <br><br>

    <!-- filtros de la tabla -->
    <div id="resultado">
      <label id="filtro">Barrio:&nbsp&nbsp</label>
      <select id="filtro_barrio" name="filtro_barrio">
          <option value="" disabled selected>-</option>
          <option value="Agronomía">Agronomía</option>
          <option value="Almagro">Almagro</option>
          <option value="Balvanera">Balvanera</option>
          <option value="Barracas">Barracas</option>
          <option value="Belgrano">Belgrano</option>
          <option value="Boedo">Boedo</option>
          <option value="Caballito">Caballito</option>
          <option value="Chacarita">Chacarita</option>
          <option value="Coghlan">Coghlan</option>
          <option value="Colegiales">Colegiales</option>
          <option value="Constitución">Constitución</option>
          <option value="Flores">Flores</option>
          <option value="Floresta">Floresta</option>
          <option value="La Boca">La Boca</option>
          <option value="La Paternal">La Paternal</option>
          <option value="Liniers">Liniers</option>
          <option value="Mataderos">Mataderos</option>
          <option value="Monte Castro">Monte Castro</option>
          <option value="Monserrat">Monserrat</option>
          <option value="Nueva Pompeya">Nueva Pompeya</option>
          <option value="Núñez">Núñez</option>
          <option value="Palermo">Palermo</option>
          <option value="Parque Avellaneda">Parque Avellaneda</option>
          <option value="Parque Chacabuco">Parque Chacabuco</option>
          <option value="Parque Chas">Parque Chas</option>
          <option value="Parque Patricios">Parque Patricios</option>
          <option value="Puerto Madero">Puerto Madero</option>
          <option value="Recoleta">Recoleta</option>
          <option value="Retiro">Retiro</option>
          <option value="Saavedra">Saavedra</option>
          <option value="San Cristóbal">San Cristóbal</option>
          <option value="San Nicolás">San Nicolás</option>
          <option value="San Telmo">San Telmo</option>
          <option value="Vélez Sársfield">Vélez Sársfield</option>
          <option value="Versalles">Versalles</option>
          <option value="Villa Crespo">Villa Crespo</option>
          <option value="Villa del Parque">Villa del Parque</option>
          <option value="Villa Devoto">Villa Devoto</option>
          <option value="Villa Gral. Mitre">Villa Gral. Mitre</option>
          <option value="Villa Lugano">Villa Lugano</option>
          <option value="Villa Luro">Villa Luro</option>
          <option value="Villa Ortúzar">Villa Ortúzar</option>
          <option value="Villa Pueyrredón">Villa Pueyrredón</option>
          <option value="Villa Real">Villa Real</option>
          <option value="Villa Riachuelo">Villa Riachuelo</option>
          <option value="Villa Santa Rita">Villa Santa Rita</option>
          <option value="Villa Soldati">Villa Soldati</option>
          <option value="Villa Urquiza">Villa Urquiza</option>
      </select>
      &nbsp&nbsp&nbsp&nbsp
      <button onclick="resetFilterTable()">Show all</button>

      <br><br>
      <table id="cafe-data">
        <thead>
          <tr id="titulo">
            <th>Cafetería</th>
            <th>Wifi Rating</th>
            <th>Direccion</th>
            <th>Barrio</th>
          </tr>
        </thead>
        <tbody id="tbody_cafes">
        </tbody>
      </table>
    </div>
  </body>

  
  





  <script src="content.js" type="application/javascript"></script>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBqHdRmzEy8iiWyULlQoBTZZntlvu51IK0",
      authDomain: "wirelesscafe-f09a3.firebaseapp.com",
      projectId: "wirelesscafe-f09a3",
      storageBucket: "wirelesscafe-f09a3.appspot.com",
      messagingSenderId: "1002846013610",
      appId: "1:1002846013610:web:768fb84283af5b7e3468d3",
      measurementId: "G-C5YPRML5XE"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);


    import {getDatabase, ref, onValue, set, get, child, update}
    from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";

    const db = getDatabase();
    var insertBtn = document.querySelector("#insert");
    insertBtn.addEventListener('click', InsertData);

    // var nombre = document.querySelector("#coffee-name");
    // var wifi = document.querySelector("#wifi-rating");
    // // var bajada = document.querySelector("#speed-down");
    // // var subida = document.querySelector("#speed-up");
    // var calle = document.querySelector("#street");
    // var barrio = document.querySelector("#barrio");

    var nombre;
    var calle;
    var registro;

    function values(cafe,direc) {
      nombre = cafe;
      calle = direc;
      document.getElementById("coffee-name").textContent = nombre;
      document.getElementById("street").textContent = calle;
      registro = (nombre + ", " + calle).replace(".","");
      // console.log(registro);
    }
    // console.log(nombre)    
    // console.log(calle)   




    // function InsertData() {
    //   var nombre = document.querySelector("#coffee-name");
    //   var calle = document.querySelector("#street");
    //   var barrio = document.getElementById("barrio");
    //   var wifi = document.getElementById("wifi-rating");


    //   if (nombre.textContent == "" || wifi.value == "" || barrio.value == "") {
    //     alert("Completar todos los campos obligatorios.");
    //     return false;
    //   }
    //   else
    //   {
    //     set(ref(db, "cafes/"+ registro),{
    //       Name: nombre.textContent,
    //       Wifi: wifi.value,
    //       Street: calle.textContent,
    //       Neigbourhood: barrio.value
    //     })
    //     .then(()=>{
    //         alert("Datos agregados correctamente.");
    //     })
    //     .catch((error)=>{
    //         alert(error);
    //     });
    //   }      
    // }



  // function InsertData() {
  //   var nombre = document.querySelector("#coffee-name");
  //   var calle = document.querySelector("#street");
  //   var barrio = document.getElementById("barrio");
  //   var wifi = document.getElementById("wifi-rating");
  //   // var registro = "12345"; // Replace with the actual value of registro

  //   var cafesRef = ref(db, "cafes");

  //   if (nombre.textContent == "" || wifi.value == "" || barrio.value == "") {
  //     alert("Completar todos los campos obligatorios.");
  //     return false;
  //   } else {
  //     get(child(cafesRef, registro)).then((snapshot) => {
  //       if (snapshot.exists()) {
  //         alert("El registro ya existe en la base de datos.");
  //       } else {
  //         // Insert the data
  //         set(child(cafesRef, registro), {
  //           Name: nombre.textContent,
  //           Wifi: wifi.value,
  //           Street: calle.textContent,
  //           Neigbourhood: barrio.value
  //         })
  //         .then(() => {
  //           alert("Datos agregados correctamente.");
  //         })
  //         .catch((error) => {
  //           alert(error);
  //         });
  //       }
  //     });
  //   }      
  // }

  function InsertData() {
    var nombre = document.querySelector("#coffee-name");
    var calle = document.querySelector("#street");
    var barrio = document.getElementById("barrio");
    var wifi = document.getElementById("wifi-rating");
    // var registro = "12345"; // Replace with the actual value of registro

    var cafesRef = ref(db, "cafes");

    if (nombre.textContent == "" || wifi.value == "" || barrio.value == "") {
      alert("Completar todos los campos obligatorios.");
      return false;
    } else {
      get(child(cafesRef, registro)).then((snapshot) => {
        if (snapshot.exists()) {
          // Update the data
          var existingData = snapshot.val();
          var existingWifi = parseFloat(existingData.Wifi);
          var newWifi = (existingWifi + parseFloat(wifi.value)) / 2;
          update(child(cafesRef, registro), {
            Name: nombre.textContent,
            Wifi: newWifi,
            Street: calle.textContent,
            Neigbourhood: barrio.value
          })
          .then(() => {
            alert("Datos actualizados correctamente.");
          })
          .catch((error) => {
            alert(error);
          });
        } else {
          // Insert the data
          set(child(cafesRef, registro), {
            Name: nombre.textContent,
            Wifi: wifi.value,
            Street: calle.textContent,
            Neigbourhood: barrio.value
          })
          .then(() => {
            alert("Datos agregados correctamente.");
          })
          .catch((error) => {
            alert(error);
          });
        }
      });
    }      
  }



    window.myFunction = values;



    const tableBody = document.querySelector("#cafe-data tbody");
    onValue(ref(db, "cafes"), (snapshot) => {
    tableBody.innerHTML = "";
    const sortedData = [];

    snapshot.forEach((childSnapshot) => {
      sortedData.push(childSnapshot.val());
    });

    sortedData.sort((a, b) => b.Wifi - a.Wifi);

    sortedData.forEach((data) => {
      const tr = document.createElement("tr");
      const wifiCell = document.createElement("td");
      const stars = Array.from({ length: data.Wifi }, () => '\u2606');
      stars.fill('\u2605', 0, data.Wifi);
      const starString = stars.join('');
      wifiCell.textContent = starString;

      tr.innerHTML += `
        <td>${data.Name}</td>
        <td class="stars">${wifiCell.textContent}</td>
        <td>${data.Street}</td>
        <td>${data.Neigbourhood}</td>
      `;
      tableBody.appendChild(tr);
    });
  });


    



      

  </script>


</html>


