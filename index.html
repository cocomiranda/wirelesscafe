<!DOCTYPE html>
<!-- v1.1 -->
<html id="html">
  <head>
    <title>Work 'n Coffee</title>
    <link id="favicon" rel="icon" type="image/x-icon" href="logo2.png" >
    <link rel="stylesheet" href="style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C5YPRML5XE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-C5YPRML5XE');
    </script>
  </head>
  
  <body>
    
    <h1><img id="img" src="logo.png">&nbspWork 'n Coffee</h1>
    <h3>Encontrá el espacio con el mejor WiFi para trabajar</h3>
    <br> 
  <h4>¿Cansado de buscar el lugar perfecto para trabajar mientras disfrutas de una deliciosa taza de café?
    <br>Work'n Coffee está acá para simplificar tu elección. 
      <br><br>
      Ya sea que necesites un lugar tranquilo para concentrarte o un ambiente inspirador para estimular tu creatividad, estamos aquí para ayudarte a encontrarlo.
    </h4>

    <br><br>
    <div id="container">
      <div id="botones">
        <button type="button" id="nuevo" style="margin-top: 5%;">Añadir nueva cafeteria</button>
        <!-- <span>&nbsp&nbsp&nbsp</span> -->
        <button type="button" id="listado">Ver cafeterias existentes</button>
      </div>
    </div>
    <br>


    <div id="nuevoContents" style="display: none;">
      <form id="form">
          <label for="coffee-name" style="display: none;" id="sitio">Sitio:</label>
          <input type="text" id="coffee-name" name="coffee-name" required style="display: none;">
          
          <label for="street" style="display: none;">Direccion:</label>
          <input type="text" id="street" name="street" style="display: none;">
          <br>
          
          <label for="street" id="label"></label><input id="pac-input" type="text" placeholder="Ingresar nombre y dirección del café" />
          
          <body>
            <div id="mapa">
              <div class="pac-card" id="pac-card">
              </div>
              <div id="map" style="height: 400px;"></div>
              <div id="infowindow-content">
                <span id="place-name" class="title"></span><br />
                <span id="place-address"></span>
              </div>
            </div>
            <script
              src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtt1qJ3l8AhfdaDszw-P4RCWztmZI2YDE&callback=initMap&libraries=places&v=weekly"
              defer
            ></script>
          </body>
          
        
          <br>


          <label for="provinces">Provincia:&nbsp</label>
          <select id="provinces" name="provinces" onchange="showCities()">
            <option value="" disabled selected>-</option>
          </select>
          <br><br>
          <label for="cities">Barrio / Localidad:&nbsp</label>
          <select id="cities" name="cities"></select>



          <br>

          <br>
          <label for="wifi-rating" >Calidad Wifi:&nbsp</label><h7 id="box-wifi" style="font-size: 12px; position: absolute; top: 20;">?</h7>&nbsp
          <select class="dropdown" id="wifi-rating" name="wifi-rating" required >
              <option value="" disabled selected>-</option>
              <option value="1">Muy Malo</option>
              <option value="2">Malo</option>
              <option value="3">Normal</option>
              <option value="4">Bueno</option>
              <option value="5">Excelente</option>
          </select>
          
          <br>

          <br>
          <label for="noise-level" >Nivel de Ruido Ambiente:&nbsp</label><h7 id="box-noise" style="font-size: 12px; position: absolute; top: 10;" >?</h7>&nbsp
          <select class="dropdown" id="noise-level" name="noise-level" required >
              <option value="" disabled selected>-</option>
              <option value="1">Silencioso</option>
              <option value="2">Tranquilo</option>
              <option value="3">Moderado</option>
              <option value="4">Ruidoso</option>
          </select>
          <br><br>

          <button type="button" id="insert" style="margin-bottom: 20%; margin-top: 5%;">Submit</button>
      </form>

      <div id="myModal" class="modal">
          <div class="modal-content">
              <span class="close"></span>
              <p>Descripción de los niveles de ruido:</p>
              <ul>
                <li><strong>★ - Silencioso:</strong> Ideal para trabajos que requieren concentración casi total o total.</li>
                <li><strong>★★ - Tranquilo:</strong> Adecuado para tareas de trabajo y charlas informales.</li>
                <li><strong>★★★ - Moderado:</strong>  Puede haber cierto ruido de fondo, un lugar funcional para trabajar y socializar.</li>
                <li><strong>★★★★ - Ruidoso:</strong> Nivel de ruido es alto y constante, lo que puede dificultar la concentración en tareas laborales.</li>
              </ul>
          </div>
      </div>
      <div id="myModal2" class="modal">
        <div class="modal-content">
            <span class="close"></span>
            <p>Descripción del nivel de wifi:</p>
            <ul>
              <li><strong>★ - Muy Malo:</strong> Lenta y poco confiable, lo que dificulta cualquier trabajo en línea significativo y puede resultar en tiempos de espera prolongados y desconexiones frecuentes.</li>
              <li><strong>★★ - Malo:</strong> Básica, adecuada solo para tareas ligeras en línea, como navegación web y correo electrónico.</li>
              <li><strong>★★★ - Normal:</strong> Funcional, pero puede experimentar breves interrupciones o velocidades reducidas en momentos de alta demanda.</li>
              <li><strong>★★★★ - Bueno:</strong> Confiable, adecuada para la mayoría de las tareas en línea, con descargas rápidas y transmisiones sin problemas.</li>
              <li><strong>★★★★★ - Excelente:</strong> Rápida y estable, proporcionando una experiencia de trabajo en línea sin problemas y de alta velocidad.</li>
            </ul>
        </div>
    </div>



      

      
    </div>
    

    <div id="formContents" style="display: none;">
      
      <!-- filtros de la tabla -->
      <div id="resultado" style="margin-top: 50px;">
        <!-- <h3 id="label_filtro" style="margin-left: 10%;">--------- Filtrá por ubicacion ---------</h3> -->

        <label for="filtro_provinces">Provincia:&nbsp</label>
          <select id="filtro_provinces" name="filtro_provinces" onchange="filtros()">
            <option value="" disabled selected>-</option></select>
          <br><br>
          <label for="filtro_cities">Barrio / Localidad:&nbsp</label>
          <select id="filtro_cities" name="filtro_cities"></select>
        

          <br><br><br>
        <!-- <button type="button" style="display: none;" id="all" onclick="filterTable()">Filtrar</button> -->
        <button type="button" id="todos" onclick="showAllRows()">Ver Todo</button>
        
        <div id="info_modal" style="display: none;">
            <div class="modal-content2">
              <span class="close"></span>
              <p>Descripción del nivel de wifi:</p>
              <ul>
                <li><strong>★ - Muy Malo:</strong> Lenta y poco confiable, lo que dificulta cualquier trabajo en línea significativo y puede resultar en tiempos de espera prolongados y desconexiones frecuentes.</li>
                <li><strong>★★ - Malo:</strong> Básica, adecuada solo para tareas ligeras en línea, como navegación web y correo electrónico.</li>
                <li><strong>★★★ - Normal:</strong> Funcional, pero puede experimentar breves interrupciones o velocidades reducidas en momentos de alta demanda.</li>
                <li><strong>★★★★ - Bueno:</strong> Confiable, adecuada para la mayoría de las tareas en línea, con descargas rápidas y transmisiones sin problemas.</li>
                <li><strong>★★★★★ - Excelente:</strong> Rápida y estable, proporcionando una experiencia de trabajo en línea sin problemas y de alta velocidad.</li>
              </ul>
            </div>
        </div>
        <div id="info_modal2" style="display: none;">
          <div class="modal-content2">
              <span class="close"></span>
              <p>Descripción de los niveles de ruido:</p>
              <ul>
                <li><strong>★ - Silencioso:</strong> Ideal para trabajos que requieren concentración casi total o total.</li>
                <li><strong>★★ - Tranquilo:</strong> Adecuado para tareas de trabajo y charlas informales.</li>
                <li><strong>★★★ - Moderado:</strong>  Puede haber cierto ruido de fondo, un lugar funcional para trabajar y socializar.</li>
                <li><strong>★★★★ - Ruidoso:</strong> Nivel de ruido es alto y constante, lo que puede dificultar la concentración en tareas laborales.</li>
              </ul>
          </div>
      </div>

        <br><br><br>
        <table id="cafe-data">
          <thead style="display: none;">
            <tr id="titulo">
              <th>Cafetería</th>
              <th id="info_wifi">Calidad WiFi</th>
              <th id="info_ruido">Nivel Ruido</th>
              <th id="info">Información</th>
              <!-- <th>Horarios</th> -->
              <th>Barrio / Localidad</th>
              <th>Provincia</th>
            </tr>
          </thead>
          <tbody id="tbody_cafes" style="display: none;">
          </tbody>
        </table>
      </div>
    </div>


    
    <form id="mensajeForm">
        <!-- <h6>Dejanos tu mensaje:</h6> -->
        <!-- <h6>Dejanos tu mensaje o escribinos por DM a <span>@WorknCoffee</span> en X.</h6> -->
        <label for="texto" >Dejanos un mensaje:</label><br>
        <textarea id="texto" rows="4" cols="50" required style="margin-top: 5px;"></textarea><br><br>
        
        <label for="nombre" >Nombre:</label><br>
        <input type="text" id="usuario" style="margin-top: 5px;"><br><br>

        <input type="submit" value="Enviar" onmouseover="this.classList.add('hand-pointer')" onmouseout="this.classList.remove('hand-pointer')">
      
        <p><em>o escribinos por DM a <a href="https://twitter.com/WorknCoffee" target="_blank">@WorknCoffee</a> en X.</em></p>

      </form>
  </body>

  
  





  <script src="content.js" type="application/javascript"></script>
  <script type="module">
    
    

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-analytics.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyBqHdRmzEy8iiWyULlQoBTZZntlvu51IK0",
        authDomain: "wirelesscafe-f09a3.firebaseapp.com",
        projectId: "wirelesscafe-f09a3",
        storageBucket: "wirelesscafe-f09a3.appspot.com",
        messagingSenderId: "1002846013610",
        appId: "1:1002846013610:web:768fb84283af5b7e3468d3",
        measurementId: "G-C5YPRML5XE"
      };

  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);






    var nuevoBtn = document.querySelector("#nuevo");
    nuevoBtn.addEventListener('click', Nuevo);
    var listadoBtn = document.querySelector("#listado");
    listadoBtn.addEventListener('click', Listado);

    function Nuevo() {
      document.querySelector("#nuevoContents").style.display = "block";
      document.querySelector("#formContents").style.display = "none";
      nuevoBtn.style.opacity = '0.6';
      listadoBtn.style.opacity = '1';
    }  
    function Listado() {
      document.querySelector("#nuevoContents").style.display = "none";
      document.querySelector("#formContents").style.display = "block";
      nuevoBtn.style.opacity = '1';
      listadoBtn.style.opacity = '0.6';
    }







    import {getDatabase, ref, onValue, set, get, child, update}
    from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";

    const db = getDatabase();
    var insertBtn = document.querySelector("#insert");
    insertBtn.addEventListener('click', InsertData);

    

    var nombre;
    var calle;
    var registro;
    var horarios;
    var usuarios;
    var number;

    function values(cafe, direc, horario, telefono) {
      nombre = cafe;
      calle = direc;
      horarios = horario;
      usuarios = reviews;
      number = telefono;
      document.getElementById("coffee-name").textContent = nombre;
      document.getElementById("street").textContent = calle;
      registro = (nombre + ", " + calle).replace(".","");
    }
  
  

  function InsertData() {
    var nombre = document.querySelector("#coffee-name");
    var calle = document.querySelector("#street");
    var barrio = document.getElementById("cities");
    var wifi = document.getElementById("wifi-rating");
    var ruido = document.getElementById("noise-level");
    var provincia = document.getElementById("provinces");
    var hours = horarios;
    var phone = number;
    var contador = usuarios;
    
    // var registro = "12345"; // Replace with the actual value of registro


    var cafesRef = ref(db, "cafes");
    if (nombre.textContent == "" || wifi.value == "" || ruido.value == "" || barrio.value == "" || provincia.value == "") {
    // if (nombre.textContent == "" ) {
      alert("Completar todos los campos.");
      return false;
    } else {
      get(child(cafesRef, registro)).then((snapshot) => {
        if (snapshot.exists()) {
          // Update the data
          var existingData = snapshot.val();
          var existingWifi = parseFloat(existingData.Wifi);
          var newWifi = (existingWifi + parseFloat(wifi.value)) / 2;
          var existingRuido = parseFloat(existingData.Ruido);
          var newRuido = (existingRuido + parseFloat(ruido.value)) / 2;
          var existingContador = existingData.Users;
          var newContador = existingContador + 1;

          update(child(cafesRef, registro), {
            Name: nombre.textContent,
            Wifi: newWifi,
            Ruido: newRuido,
            // Street: calle.textContent,
            // Neigbourhood: barrio.value,
            // Province: provincia.value,
            // Horarios: hours,
            // Phone: phone,
            Users: newContador
          })
          .then(() => {
            alert("Datos agregados correctamente.");
            const token = '6086969047:AAG9RlsqrusNHjqBMmR2Cp4W1WikjksEfQU'; // Replace with your Telegram bot token
            const chatId = '-1001821689872'; // Replace with the chat ID of the user or group you want to send the message to
            const message = '[Firebase] - Update - ' + (nombre.textContent) + ' - ' + (barrio.value) + ' - ' + (provincia.value); 
            fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${message}`)
              // .then(response => {
              //   if (response.ok) {
              //     console.log('Message sent successfully!');
              //   } else {
              //     console.error('Failed to send message.');
              //   }
              // })
              // .catch(error => {
              //   console.error('Error sending message:', error);
              // });

          })
          .catch((error) => {
            alert(error);
          });
        } else {
          // Insert the data
          // console.log(registro)
          newContador = 1;
          set(child(cafesRef, registro), {
            Name: nombre.textContent,
            Wifi: wifi.value,
            Ruido: ruido.value,
            Street: calle.textContent,
            Neigbourhood: barrio.value,
            Province: provincia.value,
            Horarios: hours,
            Phone: phone,
            Users: newContador
          })
          .then(() => {
            alert("Datos agregados correctamente.");
          })
          .catch((error) => {
            alert(error);
          });
          
          const token = '6086969047:AAG9RlsqrusNHjqBMmR2Cp4W1WikjksEfQU'; // Replace with your Telegram bot token
          const chatId = '-1001821689872'; // Replace with the chat ID of the user or group you want to send the message to
          const message = '[Firebase] - New - ' + (nombre.textContent) + ' - ' + (calle.textContent) + ' - ' + (barrio.value) + ' - ' + (provincia.value); // Replace with the message you want to send

          fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${message}`)
              // .then(response => {
              //   if (response.ok) {
              //     console.log('Message sent successfully!!!!!');
              //   } else {
              //     console.error('Failed to send message.');
              //   }
              // })
              // .catch(error => {
              //   console.error('Error sending message:', error);
              // });
        }
      });
    }      
  }



    window.myFunction = values;


    const tableBody = document.querySelector("#cafe-data tbody");
    const tableHead = document.querySelector("#cafe-data thead");
    onValue(ref(db, "cafes"), (snapshot) => {
    tableBody.innerHTML = "";
    const sortedData = [];

    snapshot.forEach((childSnapshot) => {
      sortedData.push(childSnapshot.val());
    });

    sortedData.sort((a, b) => b.Wifi - a.Wifi);


    // function logHorarios(horarios) {
    //   console.log(horarios);
    // }

    
    sortedData.forEach((data) => {
      const tr = document.createElement("tr");

      const wifiCell = document.createElement("td");
      const stars = Array.from({ length: data.Wifi }, () => '\u2606');
      stars.fill('\u2605', 0, data.Wifi);
      const starString = stars.join('');
      wifiCell.textContent = starString;

      const ruidoCell = document.createElement("td");
      const stars2 = Array.from({ length: data.Ruido }, () => '\u2606');
      stars2.fill('\u2605', 0, data.Ruido);
      const starString2 = stars2.join('');
      ruidoCell.textContent = starString2;



      // <td id="hs">${addLineBreaksToOpeningHours(data.Horarios)}</td>
      // onclick="logHorarios('${data.Horarios}')"

      // onclick="maps_search('${data.Name}')"
      
      tr.innerHTML += `
        <td>${data.Name} </td>
        <td class="stars">${wifiCell.textContent}</td>
        <td class="stars">${ruidoCell.textContent}</td>

        <td style="min-width: 70px; vertical-align: middle; display: none;">
          <span
            src="map.png"
            onclick="toggleMap(this);"
            onmouseover="this.classList.add('hand-pointer')"
            onmouseout="this.classList.remove('hand-pointer')"
          >
            <img id="icon_map" src="map.png">
          </span>
         
          <span
              src="time.png"
              onclick="toggleHours(this);"
              onmouseover="this.classList.add('hand-pointer')"
              onmouseout="this.classList.remove('hand-pointer')"
          >
              <img id="icon_hours" src="time.png">
          </span>
          
          <span
              src="phone.png"
              onclick="togglePhone(this);"
              onmouseover="this.classList.add('hand-pointer')"
              onmouseout="this.classList.remove('hand-pointer')"
          >
              <img id="icon_phone" src="phone.png">
          </span>

          <span id="reviews" style:"vertical-align: middle;" >&nbsp${data.Users}&nbsp<img id="icon_user" src="user.png"></span>
          
          
          <span id="hs" style="display: none; vertical-align: middle;">${addLineBreaksToOpeningHours(data.Horarios)}</span>
          <br>
          <span id="address" style="display: none; vertical-align: middle;">
              <br>
              ${data.Street}
              <br>
              <span style="font-size: 12px; font-style: italic;"
              onmouseover="this.classList.add('hand-pointer'); this.style.color='red';"
              onmouseout="this.classList.remove('hand-pointer'); this.style.color='';"
              onclick="maps_search('${data.Name}')"
              >
              Ir Ahora
              </span>
              <br>
          </span>

          <span id="phone" style="display: none; vertical-align: middle;"
              onclick="makePhoneCall('${data.Phone}')" 
              onmouseover="this.classList.add('hand-pointer'); this.style.color='red';"
              onmouseout="this.classList.remove('hand-pointer'); this.style.color='';"
              >
              <br>${(data.Phone)}<br>
          </span>
        </td>


        <td>${data.Neigbourhood}</td>
        <td>${data.Province}</td>
      `;
      
      tableBody.appendChild(tr);
      
    });

    
    function addLineBreaksToOpeningHours(openingHours) {
      if (!openingHours) {
        return "Not available";
      }
      // Regular expression to match the days of the week in Spanish
      const daysOfWeekRegex = /(lunes|martes|miércoles|jueves|viernes|sábado|domingo)/gi;
      // Replace each occurrence of a day with a <br> tag plus the day name
      let formattedOpeningHours = openingHours.replace(daysOfWeekRegex, (match) => {
        return "<br>" + match.charAt(0).toUpperCase() + match.slice(1);
      });
      // Add a <br> tag at the end of the string
      return formattedOpeningHours;
    }


  });


    
  
  </script>


</html>






















